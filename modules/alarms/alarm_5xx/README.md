# Alarm ALB with code 5xx
Create a alarm to ALB with code 5xx.

The number of HTTP 5XX server error codes that originate from the load balancer. This count does not include any response codes generated by the targets.

Reporting criteria: There is a nonzero value

Statistics: The most useful statistic is Sum. Minimum, Maximum, and Average all return 1.

Dimensions

    LoadBalancer

    AvailabilityZone, LoadBalancer



### Example 

```
module "target-metric-5xx" {
    source = "git::ssh://git@github.com/${var.githubproject}.git//modules/alarms/alarm_5xx"

    alarm_name          = "${var.service}-${var.region}-${var.environment[terraform.workspace]}-5xx"
    comparison_operator = var.comparison_operator
    evaluation_periods  = var.evaluation_periods
    metric_name         = var.metric_name
    namespace           = var.namespace
    period              = var.period
    statistic           = var.statistic
    threshold           = var.threshold
    LoadBalancerName    = aws_alb.main.arn_suffix
    TargetGroup         = aws_alb_target_group.app.arn_suffix
    alarm_description   = var.alarm_description 
    treat_missing_data  = var.treat_missing_data
    country             = var.country
    team                = var.team
    resource            = var.resource_alarm
    region              = var.region
    service             = var.service
    account             = var.account
    user_sns            = var.user_sns[terraform.workspace]
}

```

### Variables

####   Alarm

```
variable "region" {
  description = "The AWS region to create things in."
  default     = "eu-wesxxxx"
}

variable "account" {
  default = "968xxxxx"
}


variable "alarm_name" {
  default = ""
}

variable "comparison_operator" {
  default = "GreaterThanThreshold" #"LessThanThreshold" #
}

variable "period" {
  default = "60"
}

variable "statistic" {
  default =  "Sum"  #"Average" #"Sum"  #"SampleCount" # "Average" # "Maximum" "Average" # 
}

variable "threshold" {
  default = "1"
}

variable "evaluation_periods" {
  default = "1"
}

variable "metric_name" {
  default = "HTTPCode_ELB_5XX_Count" # "HealthyHostCount"# "HTTPCode_ELB_503_Count"# "HealthyHostCount" # #"GroupInServiceInstances"  #"HTTPCode_Target_5XX_Count" # "UnHealthyHostCount" #"HealthyHostCount" #"ecs_exception"
}

variable "namespace" {
  default = "AWS/ApplicationELB"
}

variable "actions_enabled" {
  default = "true"
}

variable "alarm_description" {
  default = " not attached to an ELB app pharma backend api"
} 
   

variable "treat_missing_data" {
  default  =  "missing" #  "breaching"  # "notBreaching" #"missing" # ignore, breaching 
}

variable "LoadBalancerName" {
  default  =  ""
}

variable "TargetGroup" {
  default  =  ""
}

variable "country" {
  default  =  "es"
}

variable "team" {
  default  =  "apps"
}

variable "resource_alarm" {
  default  =  "alarm"
}

variable "user_sns" {
  type = map(string)
  default = {
    "staging" =  "leopards"
    "production" = "leopards"
  }
}


```